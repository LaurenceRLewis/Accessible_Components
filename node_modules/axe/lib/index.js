"use strict";

// eslint-disable-next-line import/no-unassigned-import
require('console-polyfill');

// eslint-disable-next-line unicorn/prefer-node-protocol
const os = require('os');
const format = require('@ladjs/format-util');
const formatSpecifiers = require('format-specifiers');
const get = require('@strikeentco/get');
const isError = require('iserror');
const isSymbol = require('is-symbol');
const mergeOptions = require('merge-options');
const pMapSeries = require('p-map-series');
const parseAppInfo = require('parse-app-info');
const parseErr = require('parse-err');
const pickDeep = require('pick-deep');
const set = require('@strikeentco/set');
const unset = require('unset-value');
const {
  boolean
} = require('boolean');
const pkg = require('../package.json');
const silentSymbol = Symbol.for('axe.silent');
const omittedLoggerKeys = new Set(['config', 'log']);
const levels = ['trace', 'debug', 'info', 'warn', 'error', 'fatal'];
const aliases = {
  warning: 'warn',
  err: 'error'
};
const levelError = `\`level\` invalid, must be: ${levels.join(', ')}`;
const name = process.env.NODE_ENV === 'development' ? false : process.env.HOSTNAME || os.hostname();

// <https://github.com/sindresorhus/is-plain-obj/blob/main/index.js>
function isPlainObject(value) {
  if (typeof value !== 'object' || value === null) {
    return false;
  }
  const prototype = Object.getPrototypeOf(value);
  return (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value) && !isSymbol(value);
}

// <https://github.com/GeenenTijd/dotify/blob/master/dotify.js>
function dotifyToArray(obj) {
  const res = [];
  function recurse(obj, current) {
    for (const key of Reflect.ownKeys(obj)) {
      const value = obj[key];
      const convertedKey = isSymbol(key) ? Symbol.keyFor(key) || key.description : key;
      const newKey = current ? current + '.' + convertedKey : convertedKey; // joined key with dot
      // if (value && typeof value === 'object' && !(value instanceof Date) && !ObjectID.isValid(value)) {
      if (isPlainObject(value)) {
        res.push(convertedKey);
        recurse(value, newKey); // it's a nested object, so do it again
      } else {
        res.push(newKey);
      }
    }
  }
  recurse(obj);
  return res;
}

// <https://stackoverflow.com/a/43233163>
function isEmpty(value) {
  return value === undefined || value === null || typeof value === 'object' && Reflect.ownKeys(value).length === 0 || typeof value === 'string' && value.trim().length === 0;
}
function isNull(value) {
  return value === null;
}
function isUndefined(value) {
  return value === undefined;
}
function isObject(value) {
  return typeof value === 'object' && value !== null && !Array.isArray(value);
}
function isString(value) {
  return typeof value === 'string';
}
function isFunction(value) {
  return typeof value === 'function';
}
class Axe {
  // eslint-disable-next-line complexity
  constructor() {
    var _this = this;
    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    const remappedFields = {};
    if (process.env.AXE_REMAPPED_META_FIELDS) {
      const fields = process.env.AXE_REMAPPED_META_FIELDS;
      const arr = fields.split(',').map(v => v.split(':'));
      for (const [prop, value] of arr) {
        remappedFields[prop] = value;
      }
    }

    // envify does not support conditionals well enough so we declare vars outside
    let omittedFields = process.env.AXE_OMIT_META_FIELDS;
    if (typeof omittedFields === 'string') omittedFields = omittedFields.split(',').map(s => s.trim());
    if (!Array.isArray(omittedFields)) omittedFields = [];
    let pickedFields = process.env.AXE_PICK_META_FIELDS;
    if (typeof pickedFields === 'string') pickedFields = pickedFields.split(',').map(s => s.trim());
    if (!Array.isArray(pickedFields)) pickedFields = [];
    this.config = mergeOptions({
      showStack: process.env.AXE_SHOW_STACK ? boolean(process.env.AXE_SHOW_STACK) : true,
      meta: Object.assign({
        show: process.env.AXE_SHOW_META ? boolean(process.env.AXE_SHOW_META) : true,
        remappedFields,
        omittedFields,
        pickedFields,
        cleanupRemapping: true,
        hideHTTP: 'is_http',
        // implemented mainly for @ladjs/graceful to
        // suppress unnecessary meta output to console
        hideMeta: 'hide_meta'
      }, typeof config.meta === 'object' ? config.meta : {}),
      version: pkg.version,
      silent: false,
      logger: console,
      name,
      level: 'info',
      levels: ['info', 'warn', 'error', 'fatal'],
      appInfo: process.env.AXE_APP_INFO ? boolean(process.env.AXE_APP_INFO) : true,
      hooks: Object.assign({
        pre: [],
        post: []
      }, typeof config.hooks === 'object' ? config.hooks : {})
    }, config);
    this.appInfo = this.config.appInfo ? isFunction(parseAppInfo) ? parseAppInfo() : false : false;
    this.log = this.log.bind(this);

    // Inherit methods from parent logger
    const methods = Object.keys(this.config.logger).filter(key => !omittedLoggerKeys.has(key));
    for (const element of methods) {
      this[element] = this.config.logger[element];
    }

    // Bind helper functions for each log level
    for (const element of levels) {
      // Ensure function exists in logger passed
      if (typeof this.config.logger[element] !== 'function') {
        if (element === 'fatal') {
          this.config.logger.fatal = this.config.logger.error || this.config.logger.info || this.config.logger.log;
        } else {
          this.config.logger[element] = this.config.logger.info || this.config.logger.log;
        }
      }

      // Bind log handler which normalizes args and populates meta
      this[element] = function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }
        return _this.log(element, ...Array.prototype.slice.call(args));
      };
    }
    this.setLevel = this.setLevel.bind(this);
    this.getNormalizedLevel = this.getNormalizedLevel.bind(this);
    this.setName = this.setName.bind(this);

    // Set the logger name
    if (this.config.name) this.setName(this.config.name);

    // Set the logger level
    this.setLevel(this.config.level);

    // Aliases
    this.err = this.error;
    this.warning = this.warn;

    // Pre and Post Hooks
    this.pre = function (level, fn) {
      this.config.hooks.pre.push(function (_level) {
        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
          args[_key2 - 1] = arguments[_key2];
        }
        if (level !== _level) return [...args];
        return fn(...args);
      });
    };
    this.post = function (level, fn) {
      this.config.hooks.post.push(function (_level) {
        for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
          args[_key3 - 1] = arguments[_key3];
        }
        if (level !== _level) return [...args];
        return fn(...args);
      });
    };
  }
  setLevel(level) {
    if (!isString(level) || levels.indexOf(level) === -1) throw new Error(levelError);
    // Support signale logger and other loggers that use `logLevel`
    if (isString(this.config.logger.logLevel)) this.config.logger.logLevel = level;else this.config.logger.level = level;
    // Adjusts `this.config.levels` array
    // so that it has all proceeding (inclusive)
    this.config.levels = levels.slice(levels.indexOf(level));
  }
  getNormalizedLevel(level) {
    if (!isString(level)) return 'info';
    if (isString(aliases[level])) return aliases[level];
    if (levels.indexOf(level) === -1) return 'info';
    return level;
  }
  setName(name) {
    if (!isString(name)) throw new Error('`name` must be a String');
    // Support signale logger and other loggers that use `scope`
    if (isString(this.config.logger.scope)) this.config.logger.scope = name;else this.config.logger.name = name;
  }

  // eslint-disable-next-line complexity
  log(level, message, meta) {
    const originalArgs = [];
    const errors = [];
    if (!isUndefined(level)) originalArgs.push(level);
    if (!isUndefined(message)) originalArgs.push(message);
    if (!isUndefined(meta)) originalArgs.push(meta);
    for (var _len4 = arguments.length, args = new Array(_len4 > 3 ? _len4 - 3 : 0), _key4 = 3; _key4 < _len4; _key4++) {
      args[_key4 - 3] = arguments[_key4];
    }
    for (const arg of Array.prototype.slice.call(args)) {
      originalArgs.push(arg);
    }
    let modifier = 0;
    if (isString(level) && isString(aliases[level])) {
      level = aliases[level];
    } else if (isError(level)) {
      meta = message;
      message = level;
      level = 'error';
    } else if (!isString(level) || levels.indexOf(level) === -1) {
      meta = message;
      message = level;
      level = this.getNormalizedLevel(level);
      modifier = -1;
    }

    // Return early if it is not a valid logging level
    if (this.config.levels.indexOf(level) === -1) return;

    // Bunyan support (meta, message, ...args)
    let isBunyan = false;
    if ((isObject(message) || Array.isArray(message)) && isString(meta)) {
      isBunyan = true;
      const _meta = meta;
      meta = message;
      message = isString(_meta) && originalArgs.length >= 3 + modifier ? format(...originalArgs.slice(2 + modifier)) : _meta;
    }

    // If message was undefined then set it to level
    if (isUndefined(message)) message = level;

    // If only `message` was passed then if it was an Object
    // preserve it as an Object by setting it as meta
    if (originalArgs.slice(1 + modifier).length === 1 && !isString(message) && !isError(message)) {
      meta = {
        message
      };
      message = level;
    } else if (!isBunyan && originalArgs.length >= 4 + modifier) {
      message = undefined;
      meta = {};
      const messages = [];
      for (const arg of originalArgs) {
        if (isError(arg)) errors.push(arg);else if (isString(arg)) messages.push(arg);
      }
      if (errors.length === 0 && messages.length > 0) message = format(...messages);else if (errors.length > 0 && level === 'log') level = 'error';
    } else if (!isBunyan && originalArgs.length === 3 + modifier && isString(message) && formatSpecifiers.some(t => message.indexOf(t) !== -1)) {
      // Otherwise if there are three args and if the `message` contains
      // a placeholder token (e.g. '%s' or '%d' - see above `formatSpecifiers` variable)
      // then we can infer that the `meta` arg passed is used for formatting
      message = format(message, meta);
      meta = {};
    } else if (!isError(message)) {
      if (isError(meta)) {
        errors.push(meta);
        meta = {};
      } else if (!isObject(meta) && !isUndefined(meta) && !isNull(meta)) {
        // If the `meta` variable passed was not an Object then convert it
        message = format(message, meta);
        meta = {};
      } else if (!isString(message)) {
        // If the message is not a string then we should run `util.format` on it
        // assuming we're formatting it like it was another argument
        // (as opposed to using something like fast-json-stringify)
        message = format(message);
      }
    } else if (isError(meta)) {
      errors.push(meta);
      // handle additional args
      for (const arg of originalArgs.slice(2 + modifier)) {
        // should skip this better with slice and modifier adjustment
        if (meta === arg) continue;
        if (isError(arg)) errors.push(arg);
      }
      meta = {};
    }
    if (!isUndefined(meta) && !isObject(meta)) meta = {
      original_meta: meta
    };else if (!isObject(meta)) meta = {};
    if (isError(message)) {
      errors.unshift(message);
      message = undefined;
    }

    //
    // rewrite `meta.err` to `meta.original_err` for consistency
    // (in case someone has an object with `.err` property on it with an error)
    //
    if (isObject(meta.err)) {
      if (isError(meta.err)) errors.push(meta.err);
      meta.original_err = isError(meta.err) ? parseErr(meta.err) : meta.err;
    }
    let err;
    if (errors.length > 0) {
      if (errors.length === 1) {
        err = errors[0];
      } else {
        err = new Error([...new Set(errors.map(e => e.message).filter(Boolean))].join('; '));
        err.stack = [...new Set(errors.map(e => e.stack).filter(Boolean))].join('\n\n');
        err.errors = errors;
      }
      meta.err = parseErr(err);
      if (!isString(message)) message = err.message;
    }

    //
    // NOTE: this was removed in v10.2.2 due to circular reference issues
    //       (the workaround would involve safeStringify and then JSON.parse which would be perf bloat)
    //       (there still might be another workaround or perhaps we don't add all the args here except additional)
    //
    // Set `args` prop with original arguments passed
    // meta.args = originalArgs;

    // Set default level on meta
    meta.level = level;

    // Add `app` object to metadata
    if (this.appInfo) meta.app = this.appInfo;

    //
    // determine log method to use
    //
    // if we didn't pass a level as a method
    // (e.g. console.info), then we should still
    // use the logger's `log` method to output
    //
    // and fatal should use error (e.g. in browser)
    //
    const method = modifier === -1 ? 'log' : level;

    // pre-hooks
    for (const hook of this.config.hooks.pre) {
      [err, message, meta] = hook(method, err, message, meta);
    }

    //
    // NOTE: using lodash _.omit and _.pick would have been _very slow_
    //
    // const omittedAndPickedFields = {
    //   ..._.omit(meta, this.config.meta.omittedFields),
    //   ..._.pick(meta, this.config.meta.pickedFields)
    // };
    //
    // also we don't want to mutate anything in `meta`
    // and ideally we only want to pick exactly what we need
    // (and not have two operations, one for omit, and one for pick)
    //

    // set a boolean flag if we had the silent symbol or not
    const hadTrueSilentSymbol = boolean(meta[silentSymbol]);
    if (!isEmpty(this.config.meta.remappedFields)) {
      for (const key of Reflect.ownKeys(this.config.meta.remappedFields)) {
        set(meta, this.config.meta.remappedFields[key], get(meta, key));
        unset(meta, key);
        // cleanup empty objects after remapping
        if (this.config.meta.cleanupRemapping) {
          const index = key.lastIndexOf('.');
          if (index === -1) continue;
          const parentKey = key.slice(0, index);
          if (isEmpty(get(meta, parentKey))) unset(meta, parentKey);
        }
      }
    }
    if (!isEmpty(this.config.meta.omittedFields) || !isEmpty(this.config.meta.pickedFields)) {
      const dotified = dotifyToArray(meta);
      // dotified = [
      //   'err.name',
      //   'err.message',
      //   'err.stack',
      //   'level',
      //   'app.name',
      //   'app.version',
      //   'app.node',
      //   'app.hash',
      //   // ...
      // ]

      if (!isEmpty(this.config.meta.omittedFields)) {
        for (const prop of this.config.meta.omittedFields) {
          // <https://stackoverflow.com/a/9882349>
          let i = dotified.length;
          while (i--) {
            if (dotified[i] === prop || !isSymbol(dotified[i]) && dotified[i].indexOf(`${prop}.`) === 0) dotified.splice(i, 1);
          }
        }
      }
      const pickedSymbols = [];
      if (!isEmpty(this.config.meta.pickedFields)) {
        for (const prop of this.config.meta.pickedFields) {
          // response.headers.boop
          // response.headers.beep
          // response.body
          // response.text
          // response
          //
          // so we need to split by the first period and omit any keys from dotified starting with it
          if (isSymbol(prop)) {
            if (meta[prop]) pickedSymbols.push([prop, meta[prop]]);
          } else {
            const index = prop.indexOf('.');
            const key = prop.slice(0, index + 1);
            if (index !== -1) {
              let i = dotified.length;
              while (i--) {
                if (dotified[i] === key.slice(0, -1)) dotified.splice(i, 1);else if (dotified[i].indexOf(key) === 0) dotified.splice(i, 1);
              }
            }
          }

          // finally add it if it did not already exist
          if (dotified.indexOf(prop) === -1) dotified.push(prop);
        }
      }

      //
      // iterate over all dotified values to check for symbols
      //
      // NOTE: this does not take into account that they could already be in `pickedSymbols`
      //       (and it doesn't also do bigints yet)
      //
      for (const prop of dotified) {
        if (isSymbol(prop)) {
          if (meta[prop] !== undefined) pickedSymbols.push([prop, meta[prop]]);
        } else if (meta[Symbol.for(prop)] !== undefined) {
          pickedSymbols.push([Symbol.for(prop), meta[Symbol.for(prop)]]);
        }
      }

      //
      // now we call pick-deep using the final array
      //
      // NOTE: this does not pick symbols nor bigints
      //
      meta = pickDeep(meta, dotified);

      //
      // if there were any top-level symbols to be
      // picked then we need to add them back here to the list
      //
      // NOTE: we'd probably want to do the same for bigints as symbols
      //
      if (pickedSymbols.length > 0) {
        for (const [key, value] of pickedSymbols) {
          meta[key] = value;
        }
      }
    }

    // only invoke logger methods if it was not silent
    if (!this.config.silent && !hadTrueSilentSymbol) {
      // Show stack trace if necessary (along with any metadata)
      if (isError(err) && this.config.showStack) {
        if (!this.config.meta.show || isEmpty(meta)) {
          this.config.logger[method](err);
        } else if (this.config.meta.hideMeta && meta[this.config.meta.hideMeta]) {
          this.config.logger[method](err);
        } else {
          this.config.logger[method](err, meta);
        }
      } else if (!this.config.meta.show || isEmpty(meta)) {
        this.config.logger[method](message);
      } else if (this.config.meta.hideMeta && meta[this.config.meta.hideMeta] || this.config.meta.hideHTTP && meta[this.config.meta.hideHTTP]) {
        this.config.logger[method](message);
      } else {
        this.config.logger[method](message, meta);
      }
    }

    // post-hooks
    if (this.config.hooks.post.length === 0) return {
      method,
      err,
      message,
      meta
    };
    return pMapSeries(this.config.hooks.post, hook => hook(method, err, message, meta)).then().catch(err => {
      this.config.logger.error(err);
    });
  }
}
module.exports = Axe;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1aXJlIiwib3MiLCJmb3JtYXQiLCJmb3JtYXRTcGVjaWZpZXJzIiwiZ2V0IiwiaXNFcnJvciIsImlzU3ltYm9sIiwibWVyZ2VPcHRpb25zIiwicE1hcFNlcmllcyIsInBhcnNlQXBwSW5mbyIsInBhcnNlRXJyIiwicGlja0RlZXAiLCJzZXQiLCJ1bnNldCIsImJvb2xlYW4iLCJwa2ciLCJzaWxlbnRTeW1ib2wiLCJTeW1ib2wiLCJmb3IiLCJvbWl0dGVkTG9nZ2VyS2V5cyIsIlNldCIsImxldmVscyIsImFsaWFzZXMiLCJ3YXJuaW5nIiwiZXJyIiwibGV2ZWxFcnJvciIsImpvaW4iLCJuYW1lIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiSE9TVE5BTUUiLCJob3N0bmFtZSIsImlzUGxhaW5PYmplY3QiLCJ2YWx1ZSIsInByb3RvdHlwZSIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwidG9TdHJpbmdUYWciLCJpdGVyYXRvciIsImRvdGlmeVRvQXJyYXkiLCJvYmoiLCJyZXMiLCJyZWN1cnNlIiwiY3VycmVudCIsImtleSIsIlJlZmxlY3QiLCJvd25LZXlzIiwiY29udmVydGVkS2V5Iiwia2V5Rm9yIiwiZGVzY3JpcHRpb24iLCJuZXdLZXkiLCJwdXNoIiwiaXNFbXB0eSIsInVuZGVmaW5lZCIsImxlbmd0aCIsInRyaW0iLCJpc051bGwiLCJpc1VuZGVmaW5lZCIsImlzT2JqZWN0IiwiQXJyYXkiLCJpc0FycmF5IiwiaXNTdHJpbmciLCJpc0Z1bmN0aW9uIiwiQXhlIiwiY29uc3RydWN0b3IiLCJfdGhpcyIsImNvbmZpZyIsImFyZ3VtZW50cyIsInJlbWFwcGVkRmllbGRzIiwiQVhFX1JFTUFQUEVEX01FVEFfRklFTERTIiwiZmllbGRzIiwiYXJyIiwic3BsaXQiLCJtYXAiLCJ2IiwicHJvcCIsIm9taXR0ZWRGaWVsZHMiLCJBWEVfT01JVF9NRVRBX0ZJRUxEUyIsInMiLCJwaWNrZWRGaWVsZHMiLCJBWEVfUElDS19NRVRBX0ZJRUxEUyIsInNob3dTdGFjayIsIkFYRV9TSE9XX1NUQUNLIiwibWV0YSIsImFzc2lnbiIsInNob3ciLCJBWEVfU0hPV19NRVRBIiwiY2xlYW51cFJlbWFwcGluZyIsImhpZGVIVFRQIiwiaGlkZU1ldGEiLCJ2ZXJzaW9uIiwic2lsZW50IiwibG9nZ2VyIiwiY29uc29sZSIsImxldmVsIiwiYXBwSW5mbyIsIkFYRV9BUFBfSU5GTyIsImhvb2tzIiwicHJlIiwicG9zdCIsImxvZyIsImJpbmQiLCJtZXRob2RzIiwia2V5cyIsImZpbHRlciIsImhhcyIsImVsZW1lbnQiLCJmYXRhbCIsImVycm9yIiwiaW5mbyIsIl9sZW4iLCJhcmdzIiwiX2tleSIsInNsaWNlIiwiY2FsbCIsInNldExldmVsIiwiZ2V0Tm9ybWFsaXplZExldmVsIiwic2V0TmFtZSIsIndhcm4iLCJmbiIsIl9sZXZlbCIsIl9sZW4yIiwiX2tleTIiLCJfbGVuMyIsIl9rZXkzIiwiaW5kZXhPZiIsIkVycm9yIiwibG9nTGV2ZWwiLCJzY29wZSIsIm1lc3NhZ2UiLCJvcmlnaW5hbEFyZ3MiLCJlcnJvcnMiLCJfbGVuNCIsIl9rZXk0IiwiYXJnIiwibW9kaWZpZXIiLCJpc0J1bnlhbiIsIl9tZXRhIiwibWVzc2FnZXMiLCJzb21lIiwidCIsIm9yaWdpbmFsX21ldGEiLCJ1bnNoaWZ0Iiwib3JpZ2luYWxfZXJyIiwiZSIsIkJvb2xlYW4iLCJzdGFjayIsImFwcCIsIm1ldGhvZCIsImhvb2siLCJoYWRUcnVlU2lsZW50U3ltYm9sIiwiaW5kZXgiLCJsYXN0SW5kZXhPZiIsInBhcmVudEtleSIsImRvdGlmaWVkIiwiaSIsInNwbGljZSIsInBpY2tlZFN5bWJvbHMiLCJ0aGVuIiwiY2F0Y2giLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tdW5hc3NpZ25lZC1pbXBvcnRcbnJlcXVpcmUoJ2NvbnNvbGUtcG9seWZpbGwnKTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHVuaWNvcm4vcHJlZmVyLW5vZGUtcHJvdG9jb2xcbmNvbnN0IG9zID0gcmVxdWlyZSgnb3MnKTtcbmNvbnN0IGZvcm1hdCA9IHJlcXVpcmUoJ0BsYWRqcy9mb3JtYXQtdXRpbCcpO1xuY29uc3QgZm9ybWF0U3BlY2lmaWVycyA9IHJlcXVpcmUoJ2Zvcm1hdC1zcGVjaWZpZXJzJyk7XG5jb25zdCBnZXQgPSByZXF1aXJlKCdAc3RyaWtlZW50Y28vZ2V0Jyk7XG5jb25zdCBpc0Vycm9yID0gcmVxdWlyZSgnaXNlcnJvcicpO1xuY29uc3QgaXNTeW1ib2wgPSByZXF1aXJlKCdpcy1zeW1ib2wnKTtcbmNvbnN0IG1lcmdlT3B0aW9ucyA9IHJlcXVpcmUoJ21lcmdlLW9wdGlvbnMnKTtcbmNvbnN0IHBNYXBTZXJpZXMgPSByZXF1aXJlKCdwLW1hcC1zZXJpZXMnKTtcbmNvbnN0IHBhcnNlQXBwSW5mbyA9IHJlcXVpcmUoJ3BhcnNlLWFwcC1pbmZvJyk7XG5jb25zdCBwYXJzZUVyciA9IHJlcXVpcmUoJ3BhcnNlLWVycicpO1xuY29uc3QgcGlja0RlZXAgPSByZXF1aXJlKCdwaWNrLWRlZXAnKTtcbmNvbnN0IHNldCA9IHJlcXVpcmUoJ0BzdHJpa2VlbnRjby9zZXQnKTtcbmNvbnN0IHVuc2V0ID0gcmVxdWlyZSgndW5zZXQtdmFsdWUnKTtcbmNvbnN0IHsgYm9vbGVhbiB9ID0gcmVxdWlyZSgnYm9vbGVhbicpO1xuY29uc3QgcGtnID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJyk7XG5cbmNvbnN0IHNpbGVudFN5bWJvbCA9IFN5bWJvbC5mb3IoJ2F4ZS5zaWxlbnQnKTtcbmNvbnN0IG9taXR0ZWRMb2dnZXJLZXlzID0gbmV3IFNldChbJ2NvbmZpZycsICdsb2cnXSk7XG5jb25zdCBsZXZlbHMgPSBbJ3RyYWNlJywgJ2RlYnVnJywgJ2luZm8nLCAnd2FybicsICdlcnJvcicsICdmYXRhbCddO1xuY29uc3QgYWxpYXNlcyA9IHsgd2FybmluZzogJ3dhcm4nLCBlcnI6ICdlcnJvcicgfTtcbmNvbnN0IGxldmVsRXJyb3IgPSBgXFxgbGV2ZWxcXGAgaW52YWxpZCwgbXVzdCBiZTogJHtsZXZlbHMuam9pbignLCAnKX1gO1xuY29uc3QgbmFtZSA9XG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnXG4gICAgPyBmYWxzZVxuICAgIDogcHJvY2Vzcy5lbnYuSE9TVE5BTUUgfHwgb3MuaG9zdG5hbWUoKTtcblxuLy8gPGh0dHBzOi8vZ2l0aHViLmNvbS9zaW5kcmVzb3JodXMvaXMtcGxhaW4tb2JqL2Jsb2IvbWFpbi9pbmRleC5qcz5cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBwcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodmFsdWUpO1xuICByZXR1cm4gKFxuICAgIChwcm90b3R5cGUgPT09IG51bGwgfHxcbiAgICAgIHByb3RvdHlwZSA9PT0gT2JqZWN0LnByb3RvdHlwZSB8fFxuICAgICAgT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvdHlwZSkgPT09IG51bGwpICYmXG4gICAgIShTeW1ib2wudG9TdHJpbmdUYWcgaW4gdmFsdWUpICYmXG4gICAgIShTeW1ib2wuaXRlcmF0b3IgaW4gdmFsdWUpICYmXG4gICAgIWlzU3ltYm9sKHZhbHVlKVxuICApO1xufVxuXG4vLyA8aHR0cHM6Ly9naXRodWIuY29tL0dlZW5lblRpamQvZG90aWZ5L2Jsb2IvbWFzdGVyL2RvdGlmeS5qcz5cbmZ1bmN0aW9uIGRvdGlmeVRvQXJyYXkob2JqKSB7XG4gIGNvbnN0IHJlcyA9IFtdO1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaiwgY3VycmVudCkge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIFJlZmxlY3Qub3duS2V5cyhvYmopKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgY29uc3QgY29udmVydGVkS2V5ID0gaXNTeW1ib2woa2V5KVxuICAgICAgICA/IFN5bWJvbC5rZXlGb3Ioa2V5KSB8fCBrZXkuZGVzY3JpcHRpb25cbiAgICAgICAgOiBrZXk7XG4gICAgICBjb25zdCBuZXdLZXkgPSBjdXJyZW50ID8gY3VycmVudCArICcuJyArIGNvbnZlcnRlZEtleSA6IGNvbnZlcnRlZEtleTsgLy8gam9pbmVkIGtleSB3aXRoIGRvdFxuICAgICAgLy8gaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpICYmICFPYmplY3RJRC5pc1ZhbGlkKHZhbHVlKSkge1xuICAgICAgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgICAgIHJlcy5wdXNoKGNvbnZlcnRlZEtleSk7XG4gICAgICAgIHJlY3Vyc2UodmFsdWUsIG5ld0tleSk7IC8vIGl0J3MgYSBuZXN0ZWQgb2JqZWN0LCBzbyBkbyBpdCBhZ2FpblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnB1c2gobmV3S2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZWN1cnNlKG9iaik7XG4gIHJldHVybiByZXM7XG59XG5cbi8vIDxodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDMyMzMxNjM+XG5mdW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7XG4gIHJldHVybiAoXG4gICAgdmFsdWUgPT09IHVuZGVmaW5lZCB8fFxuICAgIHZhbHVlID09PSBudWxsIHx8XG4gICAgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgUmVmbGVjdC5vd25LZXlzKHZhbHVlKS5sZW5ndGggPT09IDApIHx8XG4gICAgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUudHJpbSgpLmxlbmd0aCA9PT0gMClcbiAgKTtcbn1cblxuZnVuY3Rpb24gaXNOdWxsKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gaXNVbmRlZmluZWQodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbHVlKTtcbn1cblxuZnVuY3Rpb24gaXNTdHJpbmcodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XG59XG5cbmZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuY2xhc3MgQXhlIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHlcbiAgY29uc3RydWN0b3IoY29uZmlnID0ge30pIHtcbiAgICBjb25zdCByZW1hcHBlZEZpZWxkcyA9IHt9O1xuICAgIGlmIChwcm9jZXNzLmVudi5BWEVfUkVNQVBQRURfTUVUQV9GSUVMRFMpIHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IHByb2Nlc3MuZW52LkFYRV9SRU1BUFBFRF9NRVRBX0ZJRUxEUztcbiAgICAgIGNvbnN0IGFyciA9IGZpZWxkcy5zcGxpdCgnLCcpLm1hcCgodikgPT4gdi5zcGxpdCgnOicpKTtcbiAgICAgIGZvciAoY29uc3QgW3Byb3AsIHZhbHVlXSBvZiBhcnIpIHtcbiAgICAgICAgcmVtYXBwZWRGaWVsZHNbcHJvcF0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBlbnZpZnkgZG9lcyBub3Qgc3VwcG9ydCBjb25kaXRpb25hbHMgd2VsbCBlbm91Z2ggc28gd2UgZGVjbGFyZSB2YXJzIG91dHNpZGVcbiAgICBsZXQgb21pdHRlZEZpZWxkcyA9IHByb2Nlc3MuZW52LkFYRV9PTUlUX01FVEFfRklFTERTO1xuICAgIGlmICh0eXBlb2Ygb21pdHRlZEZpZWxkcyA9PT0gJ3N0cmluZycpXG4gICAgICBvbWl0dGVkRmllbGRzID0gb21pdHRlZEZpZWxkcy5zcGxpdCgnLCcpLm1hcCgocykgPT4gcy50cmltKCkpO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShvbWl0dGVkRmllbGRzKSkgb21pdHRlZEZpZWxkcyA9IFtdO1xuXG4gICAgbGV0IHBpY2tlZEZpZWxkcyA9IHByb2Nlc3MuZW52LkFYRV9QSUNLX01FVEFfRklFTERTO1xuICAgIGlmICh0eXBlb2YgcGlja2VkRmllbGRzID09PSAnc3RyaW5nJylcbiAgICAgIHBpY2tlZEZpZWxkcyA9IHBpY2tlZEZpZWxkcy5zcGxpdCgnLCcpLm1hcCgocykgPT4gcy50cmltKCkpO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShwaWNrZWRGaWVsZHMpKSBwaWNrZWRGaWVsZHMgPSBbXTtcblxuICAgIHRoaXMuY29uZmlnID0gbWVyZ2VPcHRpb25zKFxuICAgICAge1xuICAgICAgICBzaG93U3RhY2s6IHByb2Nlc3MuZW52LkFYRV9TSE9XX1NUQUNLXG4gICAgICAgICAgPyBib29sZWFuKHByb2Nlc3MuZW52LkFYRV9TSE9XX1NUQUNLKVxuICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgbWV0YTogT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzaG93OiBwcm9jZXNzLmVudi5BWEVfU0hPV19NRVRBXG4gICAgICAgICAgICAgID8gYm9vbGVhbihwcm9jZXNzLmVudi5BWEVfU0hPV19NRVRBKVxuICAgICAgICAgICAgICA6IHRydWUsXG4gICAgICAgICAgICByZW1hcHBlZEZpZWxkcyxcbiAgICAgICAgICAgIG9taXR0ZWRGaWVsZHMsXG4gICAgICAgICAgICBwaWNrZWRGaWVsZHMsXG4gICAgICAgICAgICBjbGVhbnVwUmVtYXBwaW5nOiB0cnVlLFxuICAgICAgICAgICAgaGlkZUhUVFA6ICdpc19odHRwJyxcbiAgICAgICAgICAgIC8vIGltcGxlbWVudGVkIG1haW5seSBmb3IgQGxhZGpzL2dyYWNlZnVsIHRvXG4gICAgICAgICAgICAvLyBzdXBwcmVzcyB1bm5lY2Vzc2FyeSBtZXRhIG91dHB1dCB0byBjb25zb2xlXG4gICAgICAgICAgICBoaWRlTWV0YTogJ2hpZGVfbWV0YSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHR5cGVvZiBjb25maWcubWV0YSA9PT0gJ29iamVjdCcgPyBjb25maWcubWV0YSA6IHt9XG4gICAgICAgICksXG4gICAgICAgIHZlcnNpb246IHBrZy52ZXJzaW9uLFxuICAgICAgICBzaWxlbnQ6IGZhbHNlLFxuICAgICAgICBsb2dnZXI6IGNvbnNvbGUsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICAgIGxldmVsczogWydpbmZvJywgJ3dhcm4nLCAnZXJyb3InLCAnZmF0YWwnXSxcbiAgICAgICAgYXBwSW5mbzogcHJvY2Vzcy5lbnYuQVhFX0FQUF9JTkZPXG4gICAgICAgICAgPyBib29sZWFuKHByb2Nlc3MuZW52LkFYRV9BUFBfSU5GTylcbiAgICAgICAgICA6IHRydWUsXG4gICAgICAgIGhvb2tzOiBPYmplY3QuYXNzaWduKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByZTogW10sXG4gICAgICAgICAgICBwb3N0OiBbXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdHlwZW9mIGNvbmZpZy5ob29rcyA9PT0gJ29iamVjdCcgPyBjb25maWcuaG9va3MgOiB7fVxuICAgICAgICApXG4gICAgICB9LFxuICAgICAgY29uZmlnXG4gICAgKTtcblxuICAgIHRoaXMuYXBwSW5mbyA9IHRoaXMuY29uZmlnLmFwcEluZm9cbiAgICAgID8gaXNGdW5jdGlvbihwYXJzZUFwcEluZm8pXG4gICAgICAgID8gcGFyc2VBcHBJbmZvKClcbiAgICAgICAgOiBmYWxzZVxuICAgICAgOiBmYWxzZTtcblxuICAgIHRoaXMubG9nID0gdGhpcy5sb2cuYmluZCh0aGlzKTtcblxuICAgIC8vIEluaGVyaXQgbWV0aG9kcyBmcm9tIHBhcmVudCBsb2dnZXJcbiAgICBjb25zdCBtZXRob2RzID0gT2JqZWN0LmtleXModGhpcy5jb25maWcubG9nZ2VyKS5maWx0ZXIoXG4gICAgICAoa2V5KSA9PiAhb21pdHRlZExvZ2dlcktleXMuaGFzKGtleSlcbiAgICApO1xuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBtZXRob2RzKSB7XG4gICAgICB0aGlzW2VsZW1lbnRdID0gdGhpcy5jb25maWcubG9nZ2VyW2VsZW1lbnRdO1xuICAgIH1cblxuICAgIC8vIEJpbmQgaGVscGVyIGZ1bmN0aW9ucyBmb3IgZWFjaCBsb2cgbGV2ZWxcbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgbGV2ZWxzKSB7XG4gICAgICAvLyBFbnN1cmUgZnVuY3Rpb24gZXhpc3RzIGluIGxvZ2dlciBwYXNzZWRcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWcubG9nZ2VyW2VsZW1lbnRdICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGlmIChlbGVtZW50ID09PSAnZmF0YWwnKSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmZhdGFsID1cbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlci5lcnJvciB8fFxuICAgICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmluZm8gfHxcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlci5sb2c7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyW2VsZW1lbnRdID1cbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlci5pbmZvIHx8IHRoaXMuY29uZmlnLmxvZ2dlci5sb2c7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQmluZCBsb2cgaGFuZGxlciB3aGljaCBub3JtYWxpemVzIGFyZ3MgYW5kIHBvcHVsYXRlcyBtZXRhXG4gICAgICB0aGlzW2VsZW1lbnRdID0gKC4uLmFyZ3MpID0+XG4gICAgICAgIHRoaXMubG9nKGVsZW1lbnQsIC4uLkFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldExldmVsID0gdGhpcy5zZXRMZXZlbC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuZ2V0Tm9ybWFsaXplZExldmVsID0gdGhpcy5nZXROb3JtYWxpemVkTGV2ZWwuYmluZCh0aGlzKTtcbiAgICB0aGlzLnNldE5hbWUgPSB0aGlzLnNldE5hbWUuYmluZCh0aGlzKTtcblxuICAgIC8vIFNldCB0aGUgbG9nZ2VyIG5hbWVcbiAgICBpZiAodGhpcy5jb25maWcubmFtZSkgdGhpcy5zZXROYW1lKHRoaXMuY29uZmlnLm5hbWUpO1xuXG4gICAgLy8gU2V0IHRoZSBsb2dnZXIgbGV2ZWxcbiAgICB0aGlzLnNldExldmVsKHRoaXMuY29uZmlnLmxldmVsKTtcblxuICAgIC8vIEFsaWFzZXNcbiAgICB0aGlzLmVyciA9IHRoaXMuZXJyb3I7XG4gICAgdGhpcy53YXJuaW5nID0gdGhpcy53YXJuO1xuXG4gICAgLy8gUHJlIGFuZCBQb3N0IEhvb2tzXG4gICAgdGhpcy5wcmUgPSBmdW5jdGlvbiAobGV2ZWwsIGZuKSB7XG4gICAgICB0aGlzLmNvbmZpZy5ob29rcy5wcmUucHVzaChmdW5jdGlvbiAoX2xldmVsLCAuLi5hcmdzKSB7XG4gICAgICAgIGlmIChsZXZlbCAhPT0gX2xldmVsKSByZXR1cm4gWy4uLmFyZ3NdO1xuICAgICAgICByZXR1cm4gZm4oLi4uYXJncyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5wb3N0ID0gZnVuY3Rpb24gKGxldmVsLCBmbikge1xuICAgICAgdGhpcy5jb25maWcuaG9va3MucG9zdC5wdXNoKGZ1bmN0aW9uIChfbGV2ZWwsIC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKGxldmVsICE9PSBfbGV2ZWwpIHJldHVybiBbLi4uYXJnc107XG4gICAgICAgIHJldHVybiBmbiguLi5hcmdzKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBzZXRMZXZlbChsZXZlbCkge1xuICAgIGlmICghaXNTdHJpbmcobGV2ZWwpIHx8IGxldmVscy5pbmRleE9mKGxldmVsKSA9PT0gLTEpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IobGV2ZWxFcnJvcik7XG4gICAgLy8gU3VwcG9ydCBzaWduYWxlIGxvZ2dlciBhbmQgb3RoZXIgbG9nZ2VycyB0aGF0IHVzZSBgbG9nTGV2ZWxgXG4gICAgaWYgKGlzU3RyaW5nKHRoaXMuY29uZmlnLmxvZ2dlci5sb2dMZXZlbCkpXG4gICAgICB0aGlzLmNvbmZpZy5sb2dnZXIubG9nTGV2ZWwgPSBsZXZlbDtcbiAgICBlbHNlIHRoaXMuY29uZmlnLmxvZ2dlci5sZXZlbCA9IGxldmVsO1xuICAgIC8vIEFkanVzdHMgYHRoaXMuY29uZmlnLmxldmVsc2AgYXJyYXlcbiAgICAvLyBzbyB0aGF0IGl0IGhhcyBhbGwgcHJvY2VlZGluZyAoaW5jbHVzaXZlKVxuICAgIHRoaXMuY29uZmlnLmxldmVscyA9IGxldmVscy5zbGljZShsZXZlbHMuaW5kZXhPZihsZXZlbCkpO1xuICB9XG5cbiAgZ2V0Tm9ybWFsaXplZExldmVsKGxldmVsKSB7XG4gICAgaWYgKCFpc1N0cmluZyhsZXZlbCkpIHJldHVybiAnaW5mbyc7XG4gICAgaWYgKGlzU3RyaW5nKGFsaWFzZXNbbGV2ZWxdKSkgcmV0dXJuIGFsaWFzZXNbbGV2ZWxdO1xuICAgIGlmIChsZXZlbHMuaW5kZXhPZihsZXZlbCkgPT09IC0xKSByZXR1cm4gJ2luZm8nO1xuICAgIHJldHVybiBsZXZlbDtcbiAgfVxuXG4gIHNldE5hbWUobmFtZSkge1xuICAgIGlmICghaXNTdHJpbmcobmFtZSkpIHRocm93IG5ldyBFcnJvcignYG5hbWVgIG11c3QgYmUgYSBTdHJpbmcnKTtcbiAgICAvLyBTdXBwb3J0IHNpZ25hbGUgbG9nZ2VyIGFuZCBvdGhlciBsb2dnZXJzIHRoYXQgdXNlIGBzY29wZWBcbiAgICBpZiAoaXNTdHJpbmcodGhpcy5jb25maWcubG9nZ2VyLnNjb3BlKSkgdGhpcy5jb25maWcubG9nZ2VyLnNjb3BlID0gbmFtZTtcbiAgICBlbHNlIHRoaXMuY29uZmlnLmxvZ2dlci5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5XG4gIGxvZyhsZXZlbCwgbWVzc2FnZSwgbWV0YSwgLi4uYXJncykge1xuICAgIGNvbnN0IG9yaWdpbmFsQXJncyA9IFtdO1xuICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgIGlmICghaXNVbmRlZmluZWQobGV2ZWwpKSBvcmlnaW5hbEFyZ3MucHVzaChsZXZlbCk7XG4gICAgaWYgKCFpc1VuZGVmaW5lZChtZXNzYWdlKSkgb3JpZ2luYWxBcmdzLnB1c2gobWVzc2FnZSk7XG4gICAgaWYgKCFpc1VuZGVmaW5lZChtZXRhKSkgb3JpZ2luYWxBcmdzLnB1c2gobWV0YSk7XG4gICAgZm9yIChjb25zdCBhcmcgb2YgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncykpIHtcbiAgICAgIG9yaWdpbmFsQXJncy5wdXNoKGFyZyk7XG4gICAgfVxuXG4gICAgbGV0IG1vZGlmaWVyID0gMDtcblxuICAgIGlmIChpc1N0cmluZyhsZXZlbCkgJiYgaXNTdHJpbmcoYWxpYXNlc1tsZXZlbF0pKSB7XG4gICAgICBsZXZlbCA9IGFsaWFzZXNbbGV2ZWxdO1xuICAgIH0gZWxzZSBpZiAoaXNFcnJvcihsZXZlbCkpIHtcbiAgICAgIG1ldGEgPSBtZXNzYWdlO1xuICAgICAgbWVzc2FnZSA9IGxldmVsO1xuICAgICAgbGV2ZWwgPSAnZXJyb3InO1xuICAgIH0gZWxzZSBpZiAoIWlzU3RyaW5nKGxldmVsKSB8fCBsZXZlbHMuaW5kZXhPZihsZXZlbCkgPT09IC0xKSB7XG4gICAgICBtZXRhID0gbWVzc2FnZTtcbiAgICAgIG1lc3NhZ2UgPSBsZXZlbDtcbiAgICAgIGxldmVsID0gdGhpcy5nZXROb3JtYWxpemVkTGV2ZWwobGV2ZWwpO1xuICAgICAgbW9kaWZpZXIgPSAtMTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gZWFybHkgaWYgaXQgaXMgbm90IGEgdmFsaWQgbG9nZ2luZyBsZXZlbFxuICAgIGlmICh0aGlzLmNvbmZpZy5sZXZlbHMuaW5kZXhPZihsZXZlbCkgPT09IC0xKSByZXR1cm47XG5cbiAgICAvLyBCdW55YW4gc3VwcG9ydCAobWV0YSwgbWVzc2FnZSwgLi4uYXJncylcbiAgICBsZXQgaXNCdW55YW4gPSBmYWxzZTtcbiAgICBpZiAoKGlzT2JqZWN0KG1lc3NhZ2UpIHx8IEFycmF5LmlzQXJyYXkobWVzc2FnZSkpICYmIGlzU3RyaW5nKG1ldGEpKSB7XG4gICAgICBpc0J1bnlhbiA9IHRydWU7XG4gICAgICBjb25zdCBfbWV0YSA9IG1ldGE7XG4gICAgICBtZXRhID0gbWVzc2FnZTtcbiAgICAgIG1lc3NhZ2UgPVxuICAgICAgICBpc1N0cmluZyhfbWV0YSkgJiYgb3JpZ2luYWxBcmdzLmxlbmd0aCA+PSAzICsgbW9kaWZpZXJcbiAgICAgICAgICA/IGZvcm1hdCguLi5vcmlnaW5hbEFyZ3Muc2xpY2UoMiArIG1vZGlmaWVyKSlcbiAgICAgICAgICA6IF9tZXRhO1xuICAgIH1cblxuICAgIC8vIElmIG1lc3NhZ2Ugd2FzIHVuZGVmaW5lZCB0aGVuIHNldCBpdCB0byBsZXZlbFxuICAgIGlmIChpc1VuZGVmaW5lZChtZXNzYWdlKSkgbWVzc2FnZSA9IGxldmVsO1xuXG4gICAgLy8gSWYgb25seSBgbWVzc2FnZWAgd2FzIHBhc3NlZCB0aGVuIGlmIGl0IHdhcyBhbiBPYmplY3RcbiAgICAvLyBwcmVzZXJ2ZSBpdCBhcyBhbiBPYmplY3QgYnkgc2V0dGluZyBpdCBhcyBtZXRhXG4gICAgaWYgKFxuICAgICAgb3JpZ2luYWxBcmdzLnNsaWNlKDEgKyBtb2RpZmllcikubGVuZ3RoID09PSAxICYmXG4gICAgICAhaXNTdHJpbmcobWVzc2FnZSkgJiZcbiAgICAgICFpc0Vycm9yKG1lc3NhZ2UpXG4gICAgKSB7XG4gICAgICBtZXRhID0geyBtZXNzYWdlIH07XG4gICAgICBtZXNzYWdlID0gbGV2ZWw7XG4gICAgfSBlbHNlIGlmICghaXNCdW55YW4gJiYgb3JpZ2luYWxBcmdzLmxlbmd0aCA+PSA0ICsgbW9kaWZpZXIpIHtcbiAgICAgIG1lc3NhZ2UgPSB1bmRlZmluZWQ7XG5cbiAgICAgIG1ldGEgPSB7fTtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgICBmb3IgKGNvbnN0IGFyZyBvZiBvcmlnaW5hbEFyZ3MpIHtcbiAgICAgICAgaWYgKGlzRXJyb3IoYXJnKSkgZXJyb3JzLnB1c2goYXJnKTtcbiAgICAgICAgZWxzZSBpZiAoaXNTdHJpbmcoYXJnKSkgbWVzc2FnZXMucHVzaChhcmcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3JzLmxlbmd0aCA9PT0gMCAmJiBtZXNzYWdlcy5sZW5ndGggPiAwKVxuICAgICAgICBtZXNzYWdlID0gZm9ybWF0KC4uLm1lc3NhZ2VzKTtcbiAgICAgIGVsc2UgaWYgKGVycm9ycy5sZW5ndGggPiAwICYmIGxldmVsID09PSAnbG9nJykgbGV2ZWwgPSAnZXJyb3InO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAhaXNCdW55YW4gJiZcbiAgICAgIG9yaWdpbmFsQXJncy5sZW5ndGggPT09IDMgKyBtb2RpZmllciAmJlxuICAgICAgaXNTdHJpbmcobWVzc2FnZSkgJiZcbiAgICAgIGZvcm1hdFNwZWNpZmllcnMuc29tZSgodCkgPT4gbWVzc2FnZS5pbmRleE9mKHQpICE9PSAtMSlcbiAgICApIHtcbiAgICAgIC8vIE90aGVyd2lzZSBpZiB0aGVyZSBhcmUgdGhyZWUgYXJncyBhbmQgaWYgdGhlIGBtZXNzYWdlYCBjb250YWluc1xuICAgICAgLy8gYSBwbGFjZWhvbGRlciB0b2tlbiAoZS5nLiAnJXMnIG9yICclZCcgLSBzZWUgYWJvdmUgYGZvcm1hdFNwZWNpZmllcnNgIHZhcmlhYmxlKVxuICAgICAgLy8gdGhlbiB3ZSBjYW4gaW5mZXIgdGhhdCB0aGUgYG1ldGFgIGFyZyBwYXNzZWQgaXMgdXNlZCBmb3IgZm9ybWF0dGluZ1xuICAgICAgbWVzc2FnZSA9IGZvcm1hdChtZXNzYWdlLCBtZXRhKTtcbiAgICAgIG1ldGEgPSB7fTtcbiAgICB9IGVsc2UgaWYgKCFpc0Vycm9yKG1lc3NhZ2UpKSB7XG4gICAgICBpZiAoaXNFcnJvcihtZXRhKSkge1xuICAgICAgICBlcnJvcnMucHVzaChtZXRhKTtcbiAgICAgICAgbWV0YSA9IHt9O1xuICAgICAgfSBlbHNlIGlmICghaXNPYmplY3QobWV0YSkgJiYgIWlzVW5kZWZpbmVkKG1ldGEpICYmICFpc051bGwobWV0YSkpIHtcbiAgICAgICAgLy8gSWYgdGhlIGBtZXRhYCB2YXJpYWJsZSBwYXNzZWQgd2FzIG5vdCBhbiBPYmplY3QgdGhlbiBjb252ZXJ0IGl0XG4gICAgICAgIG1lc3NhZ2UgPSBmb3JtYXQobWVzc2FnZSwgbWV0YSk7XG4gICAgICAgIG1ldGEgPSB7fTtcbiAgICAgIH0gZWxzZSBpZiAoIWlzU3RyaW5nKG1lc3NhZ2UpKSB7XG4gICAgICAgIC8vIElmIHRoZSBtZXNzYWdlIGlzIG5vdCBhIHN0cmluZyB0aGVuIHdlIHNob3VsZCBydW4gYHV0aWwuZm9ybWF0YCBvbiBpdFxuICAgICAgICAvLyBhc3N1bWluZyB3ZSdyZSBmb3JtYXR0aW5nIGl0IGxpa2UgaXQgd2FzIGFub3RoZXIgYXJndW1lbnRcbiAgICAgICAgLy8gKGFzIG9wcG9zZWQgdG8gdXNpbmcgc29tZXRoaW5nIGxpa2UgZmFzdC1qc29uLXN0cmluZ2lmeSlcbiAgICAgICAgbWVzc2FnZSA9IGZvcm1hdChtZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzRXJyb3IobWV0YSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKG1ldGEpO1xuICAgICAgLy8gaGFuZGxlIGFkZGl0aW9uYWwgYXJnc1xuICAgICAgZm9yIChjb25zdCBhcmcgb2Ygb3JpZ2luYWxBcmdzLnNsaWNlKDIgKyBtb2RpZmllcikpIHtcbiAgICAgICAgLy8gc2hvdWxkIHNraXAgdGhpcyBiZXR0ZXIgd2l0aCBzbGljZSBhbmQgbW9kaWZpZXIgYWRqdXN0bWVudFxuICAgICAgICBpZiAobWV0YSA9PT0gYXJnKSBjb250aW51ZTtcbiAgICAgICAgaWYgKGlzRXJyb3IoYXJnKSkgZXJyb3JzLnB1c2goYXJnKTtcbiAgICAgIH1cblxuICAgICAgbWV0YSA9IHt9O1xuICAgIH1cblxuICAgIGlmICghaXNVbmRlZmluZWQobWV0YSkgJiYgIWlzT2JqZWN0KG1ldGEpKSBtZXRhID0geyBvcmlnaW5hbF9tZXRhOiBtZXRhIH07XG4gICAgZWxzZSBpZiAoIWlzT2JqZWN0KG1ldGEpKSBtZXRhID0ge307XG5cbiAgICBpZiAoaXNFcnJvcihtZXNzYWdlKSkge1xuICAgICAgZXJyb3JzLnVuc2hpZnQobWVzc2FnZSk7XG4gICAgICBtZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vXG4gICAgLy8gcmV3cml0ZSBgbWV0YS5lcnJgIHRvIGBtZXRhLm9yaWdpbmFsX2VycmAgZm9yIGNvbnNpc3RlbmN5XG4gICAgLy8gKGluIGNhc2Ugc29tZW9uZSBoYXMgYW4gb2JqZWN0IHdpdGggYC5lcnJgIHByb3BlcnR5IG9uIGl0IHdpdGggYW4gZXJyb3IpXG4gICAgLy9cbiAgICBpZiAoaXNPYmplY3QobWV0YS5lcnIpKSB7XG4gICAgICBpZiAoaXNFcnJvcihtZXRhLmVycikpIGVycm9ycy5wdXNoKG1ldGEuZXJyKTtcbiAgICAgIG1ldGEub3JpZ2luYWxfZXJyID0gaXNFcnJvcihtZXRhLmVycikgPyBwYXJzZUVycihtZXRhLmVycikgOiBtZXRhLmVycjtcbiAgICB9XG5cbiAgICBsZXQgZXJyO1xuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKGVycm9ycy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgZXJyID0gZXJyb3JzWzBdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXJyID0gbmV3IEVycm9yKFxuICAgICAgICAgIFsuLi5uZXcgU2V0KGVycm9ycy5tYXAoKGUpID0+IGUubWVzc2FnZSkuZmlsdGVyKEJvb2xlYW4pKV0uam9pbignOyAnKVxuICAgICAgICApO1xuICAgICAgICBlcnIuc3RhY2sgPSBbXG4gICAgICAgICAgLi4ubmV3IFNldChlcnJvcnMubWFwKChlKSA9PiBlLnN0YWNrKS5maWx0ZXIoQm9vbGVhbikpXG4gICAgICAgIF0uam9pbignXFxuXFxuJyk7XG4gICAgICAgIGVyci5lcnJvcnMgPSBlcnJvcnM7XG4gICAgICB9XG5cbiAgICAgIG1ldGEuZXJyID0gcGFyc2VFcnIoZXJyKTtcbiAgICAgIGlmICghaXNTdHJpbmcobWVzc2FnZSkpIG1lc3NhZ2UgPSBlcnIubWVzc2FnZTtcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIE5PVEU6IHRoaXMgd2FzIHJlbW92ZWQgaW4gdjEwLjIuMiBkdWUgdG8gY2lyY3VsYXIgcmVmZXJlbmNlIGlzc3Vlc1xuICAgIC8vICAgICAgICh0aGUgd29ya2Fyb3VuZCB3b3VsZCBpbnZvbHZlIHNhZmVTdHJpbmdpZnkgYW5kIHRoZW4gSlNPTi5wYXJzZSB3aGljaCB3b3VsZCBiZSBwZXJmIGJsb2F0KVxuICAgIC8vICAgICAgICh0aGVyZSBzdGlsbCBtaWdodCBiZSBhbm90aGVyIHdvcmthcm91bmQgb3IgcGVyaGFwcyB3ZSBkb24ndCBhZGQgYWxsIHRoZSBhcmdzIGhlcmUgZXhjZXB0IGFkZGl0aW9uYWwpXG4gICAgLy9cbiAgICAvLyBTZXQgYGFyZ3NgIHByb3Agd2l0aCBvcmlnaW5hbCBhcmd1bWVudHMgcGFzc2VkXG4gICAgLy8gbWV0YS5hcmdzID0gb3JpZ2luYWxBcmdzO1xuXG4gICAgLy8gU2V0IGRlZmF1bHQgbGV2ZWwgb24gbWV0YVxuICAgIG1ldGEubGV2ZWwgPSBsZXZlbDtcblxuICAgIC8vIEFkZCBgYXBwYCBvYmplY3QgdG8gbWV0YWRhdGFcbiAgICBpZiAodGhpcy5hcHBJbmZvKSBtZXRhLmFwcCA9IHRoaXMuYXBwSW5mbztcblxuICAgIC8vXG4gICAgLy8gZGV0ZXJtaW5lIGxvZyBtZXRob2QgdG8gdXNlXG4gICAgLy9cbiAgICAvLyBpZiB3ZSBkaWRuJ3QgcGFzcyBhIGxldmVsIGFzIGEgbWV0aG9kXG4gICAgLy8gKGUuZy4gY29uc29sZS5pbmZvKSwgdGhlbiB3ZSBzaG91bGQgc3RpbGxcbiAgICAvLyB1c2UgdGhlIGxvZ2dlcidzIGBsb2dgIG1ldGhvZCB0byBvdXRwdXRcbiAgICAvL1xuICAgIC8vIGFuZCBmYXRhbCBzaG91bGQgdXNlIGVycm9yIChlLmcuIGluIGJyb3dzZXIpXG4gICAgLy9cbiAgICBjb25zdCBtZXRob2QgPSBtb2RpZmllciA9PT0gLTEgPyAnbG9nJyA6IGxldmVsO1xuXG4gICAgLy8gcHJlLWhvb2tzXG4gICAgZm9yIChjb25zdCBob29rIG9mIHRoaXMuY29uZmlnLmhvb2tzLnByZSkge1xuICAgICAgW2VyciwgbWVzc2FnZSwgbWV0YV0gPSBob29rKG1ldGhvZCwgZXJyLCBtZXNzYWdlLCBtZXRhKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIE5PVEU6IHVzaW5nIGxvZGFzaCBfLm9taXQgYW5kIF8ucGljayB3b3VsZCBoYXZlIGJlZW4gX3Zlcnkgc2xvd19cbiAgICAvL1xuICAgIC8vIGNvbnN0IG9taXR0ZWRBbmRQaWNrZWRGaWVsZHMgPSB7XG4gICAgLy8gICAuLi5fLm9taXQobWV0YSwgdGhpcy5jb25maWcubWV0YS5vbWl0dGVkRmllbGRzKSxcbiAgICAvLyAgIC4uLl8ucGljayhtZXRhLCB0aGlzLmNvbmZpZy5tZXRhLnBpY2tlZEZpZWxkcylcbiAgICAvLyB9O1xuICAgIC8vXG4gICAgLy8gYWxzbyB3ZSBkb24ndCB3YW50IHRvIG11dGF0ZSBhbnl0aGluZyBpbiBgbWV0YWBcbiAgICAvLyBhbmQgaWRlYWxseSB3ZSBvbmx5IHdhbnQgdG8gcGljayBleGFjdGx5IHdoYXQgd2UgbmVlZFxuICAgIC8vIChhbmQgbm90IGhhdmUgdHdvIG9wZXJhdGlvbnMsIG9uZSBmb3Igb21pdCwgYW5kIG9uZSBmb3IgcGljaylcbiAgICAvL1xuXG4gICAgLy8gc2V0IGEgYm9vbGVhbiBmbGFnIGlmIHdlIGhhZCB0aGUgc2lsZW50IHN5bWJvbCBvciBub3RcbiAgICBjb25zdCBoYWRUcnVlU2lsZW50U3ltYm9sID0gYm9vbGVhbihtZXRhW3NpbGVudFN5bWJvbF0pO1xuXG4gICAgaWYgKCFpc0VtcHR5KHRoaXMuY29uZmlnLm1ldGEucmVtYXBwZWRGaWVsZHMpKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBSZWZsZWN0Lm93bktleXModGhpcy5jb25maWcubWV0YS5yZW1hcHBlZEZpZWxkcykpIHtcbiAgICAgICAgc2V0KG1ldGEsIHRoaXMuY29uZmlnLm1ldGEucmVtYXBwZWRGaWVsZHNba2V5XSwgZ2V0KG1ldGEsIGtleSkpO1xuICAgICAgICB1bnNldChtZXRhLCBrZXkpO1xuICAgICAgICAvLyBjbGVhbnVwIGVtcHR5IG9iamVjdHMgYWZ0ZXIgcmVtYXBwaW5nXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5tZXRhLmNsZWFudXBSZW1hcHBpbmcpIHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGtleS5sYXN0SW5kZXhPZignLicpO1xuICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIGNvbnRpbnVlO1xuICAgICAgICAgIGNvbnN0IHBhcmVudEtleSA9IGtleS5zbGljZSgwLCBpbmRleCk7XG4gICAgICAgICAgaWYgKGlzRW1wdHkoZ2V0KG1ldGEsIHBhcmVudEtleSkpKSB1bnNldChtZXRhLCBwYXJlbnRLZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIWlzRW1wdHkodGhpcy5jb25maWcubWV0YS5vbWl0dGVkRmllbGRzKSB8fFxuICAgICAgIWlzRW1wdHkodGhpcy5jb25maWcubWV0YS5waWNrZWRGaWVsZHMpXG4gICAgKSB7XG4gICAgICBjb25zdCBkb3RpZmllZCA9IGRvdGlmeVRvQXJyYXkobWV0YSk7XG4gICAgICAvLyBkb3RpZmllZCA9IFtcbiAgICAgIC8vICAgJ2Vyci5uYW1lJyxcbiAgICAgIC8vICAgJ2Vyci5tZXNzYWdlJyxcbiAgICAgIC8vICAgJ2Vyci5zdGFjaycsXG4gICAgICAvLyAgICdsZXZlbCcsXG4gICAgICAvLyAgICdhcHAubmFtZScsXG4gICAgICAvLyAgICdhcHAudmVyc2lvbicsXG4gICAgICAvLyAgICdhcHAubm9kZScsXG4gICAgICAvLyAgICdhcHAuaGFzaCcsXG4gICAgICAvLyAgIC8vIC4uLlxuICAgICAgLy8gXVxuXG4gICAgICBpZiAoIWlzRW1wdHkodGhpcy5jb25maWcubWV0YS5vbWl0dGVkRmllbGRzKSkge1xuICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgdGhpcy5jb25maWcubWV0YS5vbWl0dGVkRmllbGRzKSB7XG4gICAgICAgICAgLy8gPGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS85ODgyMzQ5PlxuICAgICAgICAgIGxldCBpID0gZG90aWZpZWQubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgZG90aWZpZWRbaV0gPT09IHByb3AgfHxcbiAgICAgICAgICAgICAgKCFpc1N5bWJvbChkb3RpZmllZFtpXSkgJiYgZG90aWZpZWRbaV0uaW5kZXhPZihgJHtwcm9wfS5gKSA9PT0gMClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgZG90aWZpZWQuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwaWNrZWRTeW1ib2xzID0gW107XG5cbiAgICAgIGlmICghaXNFbXB0eSh0aGlzLmNvbmZpZy5tZXRhLnBpY2tlZEZpZWxkcykpIHtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wIG9mIHRoaXMuY29uZmlnLm1ldGEucGlja2VkRmllbGRzKSB7XG4gICAgICAgICAgLy8gcmVzcG9uc2UuaGVhZGVycy5ib29wXG4gICAgICAgICAgLy8gcmVzcG9uc2UuaGVhZGVycy5iZWVwXG4gICAgICAgICAgLy8gcmVzcG9uc2UuYm9keVxuICAgICAgICAgIC8vIHJlc3BvbnNlLnRleHRcbiAgICAgICAgICAvLyByZXNwb25zZVxuICAgICAgICAgIC8vXG4gICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBzcGxpdCBieSB0aGUgZmlyc3QgcGVyaW9kIGFuZCBvbWl0IGFueSBrZXlzIGZyb20gZG90aWZpZWQgc3RhcnRpbmcgd2l0aCBpdFxuICAgICAgICAgIGlmIChpc1N5bWJvbChwcm9wKSkge1xuICAgICAgICAgICAgaWYgKG1ldGFbcHJvcF0pIHBpY2tlZFN5bWJvbHMucHVzaChbcHJvcCwgbWV0YVtwcm9wXV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHByb3AuaW5kZXhPZignLicpO1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gcHJvcC5zbGljZSgwLCBpbmRleCArIDEpO1xuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICBsZXQgaSA9IGRvdGlmaWVkLmxlbmd0aDtcbiAgICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChkb3RpZmllZFtpXSA9PT0ga2V5LnNsaWNlKDAsIC0xKSkgZG90aWZpZWQuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvdGlmaWVkW2ldLmluZGV4T2Yoa2V5KSA9PT0gMCkgZG90aWZpZWQuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gZmluYWxseSBhZGQgaXQgaWYgaXQgZGlkIG5vdCBhbHJlYWR5IGV4aXN0XG4gICAgICAgICAgaWYgKGRvdGlmaWVkLmluZGV4T2YocHJvcCkgPT09IC0xKSBkb3RpZmllZC5wdXNoKHByb3ApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vXG4gICAgICAvLyBpdGVyYXRlIG92ZXIgYWxsIGRvdGlmaWVkIHZhbHVlcyB0byBjaGVjayBmb3Igc3ltYm9sc1xuICAgICAgLy9cbiAgICAgIC8vIE5PVEU6IHRoaXMgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhhdCB0aGV5IGNvdWxkIGFscmVhZHkgYmUgaW4gYHBpY2tlZFN5bWJvbHNgXG4gICAgICAvLyAgICAgICAoYW5kIGl0IGRvZXNuJ3QgYWxzbyBkbyBiaWdpbnRzIHlldClcbiAgICAgIC8vXG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgZG90aWZpZWQpIHtcbiAgICAgICAgaWYgKGlzU3ltYm9sKHByb3ApKSB7XG4gICAgICAgICAgaWYgKG1ldGFbcHJvcF0gIT09IHVuZGVmaW5lZCkgcGlja2VkU3ltYm9scy5wdXNoKFtwcm9wLCBtZXRhW3Byb3BdXSk7XG4gICAgICAgIH0gZWxzZSBpZiAobWV0YVtTeW1ib2wuZm9yKHByb3ApXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcGlja2VkU3ltYm9scy5wdXNoKFtTeW1ib2wuZm9yKHByb3ApLCBtZXRhW1N5bWJvbC5mb3IocHJvcCldXSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy9cbiAgICAgIC8vIG5vdyB3ZSBjYWxsIHBpY2stZGVlcCB1c2luZyB0aGUgZmluYWwgYXJyYXlcbiAgICAgIC8vXG4gICAgICAvLyBOT1RFOiB0aGlzIGRvZXMgbm90IHBpY2sgc3ltYm9scyBub3IgYmlnaW50c1xuICAgICAgLy9cbiAgICAgIG1ldGEgPSBwaWNrRGVlcChtZXRhLCBkb3RpZmllZCk7XG5cbiAgICAgIC8vXG4gICAgICAvLyBpZiB0aGVyZSB3ZXJlIGFueSB0b3AtbGV2ZWwgc3ltYm9scyB0byBiZVxuICAgICAgLy8gcGlja2VkIHRoZW4gd2UgbmVlZCB0byBhZGQgdGhlbSBiYWNrIGhlcmUgdG8gdGhlIGxpc3RcbiAgICAgIC8vXG4gICAgICAvLyBOT1RFOiB3ZSdkIHByb2JhYmx5IHdhbnQgdG8gZG8gdGhlIHNhbWUgZm9yIGJpZ2ludHMgYXMgc3ltYm9sc1xuICAgICAgLy9cbiAgICAgIGlmIChwaWNrZWRTeW1ib2xzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcGlja2VkU3ltYm9scykge1xuICAgICAgICAgIG1ldGFba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gb25seSBpbnZva2UgbG9nZ2VyIG1ldGhvZHMgaWYgaXQgd2FzIG5vdCBzaWxlbnRcbiAgICBpZiAoIXRoaXMuY29uZmlnLnNpbGVudCAmJiAhaGFkVHJ1ZVNpbGVudFN5bWJvbCkge1xuICAgICAgLy8gU2hvdyBzdGFjayB0cmFjZSBpZiBuZWNlc3NhcnkgKGFsb25nIHdpdGggYW55IG1ldGFkYXRhKVxuICAgICAgaWYgKGlzRXJyb3IoZXJyKSAmJiB0aGlzLmNvbmZpZy5zaG93U3RhY2spIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5tZXRhLnNob3cgfHwgaXNFbXB0eShtZXRhKSkge1xuICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlclttZXRob2RdKGVycik7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgdGhpcy5jb25maWcubWV0YS5oaWRlTWV0YSAmJlxuICAgICAgICAgIG1ldGFbdGhpcy5jb25maWcubWV0YS5oaWRlTWV0YV1cbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyW21ldGhvZF0oZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5sb2dnZXJbbWV0aG9kXShlcnIsIG1ldGEpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCF0aGlzLmNvbmZpZy5tZXRhLnNob3cgfHwgaXNFbXB0eShtZXRhKSkge1xuICAgICAgICB0aGlzLmNvbmZpZy5sb2dnZXJbbWV0aG9kXShtZXNzYWdlKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICh0aGlzLmNvbmZpZy5tZXRhLmhpZGVNZXRhICYmIG1ldGFbdGhpcy5jb25maWcubWV0YS5oaWRlTWV0YV0pIHx8XG4gICAgICAgICh0aGlzLmNvbmZpZy5tZXRhLmhpZGVIVFRQICYmIG1ldGFbdGhpcy5jb25maWcubWV0YS5oaWRlSFRUUF0pXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyW21ldGhvZF0obWVzc2FnZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNvbmZpZy5sb2dnZXJbbWV0aG9kXShtZXNzYWdlLCBtZXRhKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBwb3N0LWhvb2tzXG4gICAgaWYgKHRoaXMuY29uZmlnLmhvb2tzLnBvc3QubGVuZ3RoID09PSAwKVxuICAgICAgcmV0dXJuIHsgbWV0aG9kLCBlcnIsIG1lc3NhZ2UsIG1ldGEgfTtcbiAgICByZXR1cm4gcE1hcFNlcmllcyh0aGlzLmNvbmZpZy5ob29rcy5wb3N0LCAoaG9vaykgPT5cbiAgICAgIGhvb2sobWV0aG9kLCBlcnIsIG1lc3NhZ2UsIG1ldGEpXG4gICAgKVxuICAgICAgLnRoZW4oKVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEF4ZTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBQSxPQUFPLENBQUMsa0JBQWtCLENBQUM7O0FBRTNCO0FBQ0EsTUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ3hCLE1BQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQzVDLE1BQU1HLGdCQUFnQixHQUFHSCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDckQsTUFBTUksR0FBRyxHQUFHSixPQUFPLENBQUMsa0JBQWtCLENBQUM7QUFDdkMsTUFBTUssT0FBTyxHQUFHTCxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1NLFFBQVEsR0FBR04sT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNyQyxNQUFNTyxZQUFZLEdBQUdQLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDN0MsTUFBTVEsVUFBVSxHQUFHUixPQUFPLENBQUMsY0FBYyxDQUFDO0FBQzFD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